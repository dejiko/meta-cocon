#-----------------------------------------------------------------------------
#@TYPE: Distribution
#@NAME: opencocon
#@DESCRIPTION: Linux distribution for old computer
#
#@COMMENT: www.opencocon.org
#-----------------------------------------------------------------------------

include conf/distro/include/default-providers.inc
include conf/distro/include/default-versions.inc
include conf/distro/include/default-distrovars.inc
include conf/distro/include/world-broken.inc

TCLIBC = "uclibc"
require conf/distro/include/tclibc-${TCLIBC}.inc

TCMODE = "default"
require conf/distro/include/tcmode-${TCMODE}.inc

CACHE = "${TMPDIR}/cache/${TCMODE}-${TCLIBC}${@['', '/' + str(d.getVar('MACHINE', True))][bool(d.getVar('MACHINE', True))]}${@['', '/' + str(d.getVar('SDKMACHINE', True))][bool(d.getVar('SDKMACHINE', True))]}"


#
# Header
#
DISTRO_NAME = "opencocon"
DISTRO_VERSION = "v4"

DISTRO_TYPE = "release"
#DISTRO_TYPE = "debug"


#INHERIT += "debian"
IMAGE_PKGTYPE = "ipk"

INHERIT += "package_ipk"

ONLINE_PACKAGE_MANAGEMENT = "none"
#OPKG_SRCREV ?= "541"

# Put links to sources in deploy/sources to make it easier for people to be GPL compliant
#INHERIT += "src_distribute_local"
SRC_DIST_LOCAL ?= "symlink"


# increase inode/block ratio for ext2 filesystem
#EXTRA_IMAGECMD_ext2 = "-i 8192"

# Global Setting
#USE_NLS ?= "yes"

PREFERRED_PROVIDER_virtual/update-alternatives = "opkg"
PREFERRED_PROVIDER_hotplug  = "udev"
PREFERRED_VERSION_udev = "175"

# KERNEL
LINUX_LIBC_HEADERS_VERSION = "3.0.33"
PREFERRED_VERSION_linux-libc-headers = "${LINUX_LIBC_HEADERS_VERSION}"
PREFERRED_VERSION_linux-libc-headers-native = "${LINUX_LIBC_HEADERS_VERSION}"
PREFERRED_VERSION_linux-libc-headers-nativesdk = "${LINUX_LIBC_HEADERS_VERSION}"


# uClibc Setting
LIBC = "uclibc"
#PREFERRED_PROVIDER_virtual/libc = "uclibc"
PREFERRED_PROVIDER_virtual/${TARGET_PREFIX}libc-for-gcc = "uclibc"
PREFERRED_PROVIDER_virtual/i486-linux-uclibc-libc-initial = "uclibc-initial"
PREFERRED_VERSION_uclibc = "0.9.33"
PREFERRED_VERSION_uclibc-initial = "0.9.33"
TARGET_LINK_HASH_STYLE = "-Wl,--hash-style=gnu"

# Busybox Setting
PREFERRED_PROVIDER_virtual/i486-pc-linux-uclibc-libc-initial = "uclibc-initial"
IMAGE_LOGIN_MANAGER = "busybox"
IMAGE_INIT_MANAGER = "busybox"
IMAGE_DEV_MANAGER = "udev"

# GCC

# Autoconf

# X.org
PREFERRED_VERSION_xf86-video-intel = "2.16.0"
PREFERRED_PROVIDER_virtual/libx11 = "libx11"

# Boot Loader
# PEFERRED_VERSION_grub = "0.97"



# FEATURE SELECTION
# We want images supporting the following features (for task-base)
DISTRO_FEATURES = "nfs ipv4 ipv6 wifi alsa ext2 vfat pcmcia usbhost pci largefile nls xattr x86 x11"
TARGET_VENDOR = "-pc"
#TARGET_SYS ?= "i486-pc-uclibc-linux"

EFL_SRCREV = "51081"

# Additional content I (only valid if you include task-base)
# distro-feed-configs: configuration files for the online feeds
# util-linux-ng-mount util-linux-ng-umount: busybox mount is broken
# angstrom-libc-fixup-hack: fixes an obscure bug with libc.so symlink
#DISTRO_EXTRA_RDEPENDS += "\
#  distro-feed-configs \
#  util-linux-ng-mount util-linux-ng-umount \
#  angstrom-libc-fixup-hack \
#  ${DISTRO_EXTRA_APPS} \
#"

# Additional content II (can be masked with BAD_RECOMMENDATIONS)
#DISTRO_EXTRA_RRECOMMENDS += " \
#    kernel-module-vfat \
#    kernel-module-ext2 \
#    kernel-module-ext3 \
#    kernel-module-af-packet \
#    avahi-daemon \
#    avahi-autoipd \
#    openssh-sftp-server \
#"

